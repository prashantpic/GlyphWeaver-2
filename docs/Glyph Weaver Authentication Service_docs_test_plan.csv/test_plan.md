test_id,feature_area,test_type,test_level,priority,automation_candidate,test_description,preconditions,test_steps,expected_result,test_data_needs,tools_required,estimated_effort,dependencies
AUTH-U-001,Configuration,Functional,Unit,High,Yes,"Verify config module loads valid environment variables correctly","A .env file is created with all required variables (PORT, MONGODB_URI, JWT_SECRET, etc.).","1. Import the config module. 2. Assert that `config.port` is a number. 3. Assert that `config.jwt.secret` is a string.","All configuration values are loaded, correctly typed, and accessible through the exported config object.",Valid .env file with all keys from SDS 3.1,Jest,0.5,WI-103
AUTH-U-002,Configuration,Functional,Unit,High,Yes,"Verify config module throws an error if a required environment variable is missing","A .env file is created with a required variable (e.g., JWT_SECRET) commented out or missing.","1. Clear the Jest module cache. 2. Attempt to import the config module. 3. Wrap the import in a `try/catch` or use `expect(...).toThrow()`.","The application throws a specific error and terminates, preventing it from starting in an insecure or invalid state.",Invalid .env file missing a required key,Jest,0.5,WI-103
AUTH-U-003,Password Service,Security,Unit,High,Yes,"Verify PasswordService correctly hashes a password","PasswordService is available.","1. Provide a plain-text password to `passwordService.hashPassword`. 2. Await the result.","The method returns a string that is a valid bcrypt hash, and is not the same as the input password.",Plain-text password string,Jest,0.5,WI-301
AUTH-U-004,Password Service,Security,Unit,High,Yes,"Verify PasswordService successfully compares a correct password and hash","PasswordService is available.","1. Hash a known password using `passwordService.hashPassword`. 2. Call `passwordService.comparePassword` with the original password and the generated hash.","The `comparePassword` method returns `true`.",Plain-text password string,Jest,0.5,WI-301
AUTH-U-005,Password Service,Security,Unit,High,Yes,"Verify PasswordService fails to compare an incorrect password and hash","PasswordService is available.","1. Hash a known password using `passwordService.hashPassword`. 2. Call `passwordService.comparePassword` with an incorrect password and the generated hash.","The `comparePassword` method returns `false`.",Plain-text password and a different password string,Jest,0.5,WI-301
AUTH-U-006,Token Service,Security,Unit,High,Yes,"Verify TokenService generates a valid access and refresh token pair","TokenService is instantiated with mocked dependencies (ITokenRepository).","1. Call `tokenService.generateAuthTokens` with a user ID payload. 2. Decode the returned accessToken and refreshToken using `jsonwebtoken.verify`. 3. Assert that the `ITokenRepository.save` method was called with the correct user ID and the new refresh token.","Both tokens are valid JWTs containing the correct user ID payload. The refresh token is saved to the repository.",User ID string,Jest,jsonwebtoken,1.5,WI-302
AUTH-S-001,Token Service,Security,Unit,High,Yes,"Verify TokenService rejects an invalid refresh token (bad signature)","TokenService is instantiated with mocked dependencies.","1. Call `tokenService.verifyRefreshToken` with a JWT that has an invalid signature. 2. Assert that the method throws an `UnauthorizedException` (or similar).","An exception is thrown, and the repository is not accessed.",JWT with invalid signature,Jest,jsonwebtoken,1,WI-302
AUTH-S-002,Token Service,Security,Unit,High,Yes,"Verify TokenService rejects a refresh token that is not in the database (already used/revoked)","TokenService is instantiated with a mocked ITokenRepository where `findByToken` returns `null`.","1. Call `tokenService.verifyRefreshToken` with a structurally valid JWT. 2. Assert that the method throws an `UnauthorizedException`.","An exception is thrown after the repository lookup fails.",Structurally valid JWT,Jest,jsonwebtoken,1,WI-302
AUTH-S-003,Token Service,Security,Unit,High,Yes,"Verify TokenService deletes a valid refresh token after successful verification (rotation)","TokenService is instantiated with a mocked ITokenRepository where `findByToken` returns a valid token object.","1. Call `tokenService.verifyRefreshToken` with a valid JWT. 2. Assert that the method returns the decoded payload. 3. Assert that `ITokenRepository.delete` was called with the token string.","The token is successfully verified, and the `delete` method on the repository is called exactly once.",Valid JWT and corresponding mock token object,Jest,jsonwebtoken,1.5,WI-302
AUTH-U-007,Auth Service,Functional,Unit,High,Yes,"Test user registration with a unique email","AuthService is instantiated with mocked dependencies (IUserRepository, IPasswordService, ITokenService). `userRepository.findByEmail` returns `null`.","1. Call `authService.registerUser` with a `RegisterUserDto`. 2. Assert that `passwordService.hashPassword` was called. 3. Assert that `userRepository.create` was called with the correct data. 4. Assert that `tokenService.generateAuthTokens` was called.","The method returns a user object and a token pair.",`RegisterUserDto` object,Jest,1,US-302
AUTH-U-008,Auth Service,Functional,Unit,High,Yes,"Test user registration with an existing email (conflict)","AuthService is instantiated with mocked dependencies. `userRepository.findByEmail` returns an existing user object.","1. Call `authService.registerUser` with a `RegisterUserDto` containing an existing email. 2. Assert that the method throws a `ConflictException`.","The method throws a `ConflictException` and does not call create/generate methods.",`RegisterUserDto` with an email that exists,Jest,1,US-302
AUTH-U-009,Auth Service,Functional,Unit,High,Yes,"Test successful email login with correct credentials","AuthService is instantiated with mocked dependencies. `userRepository.findByEmail` returns a user object with a hashed password. `passwordService.comparePassword` returns `true`.","1. Call `authService.authenticateByEmail` with a `LoginEmailDto`. 2. Assert that `userRepository.findByEmail` was called. 3. Assert that `passwordService.comparePassword` was called. 4. Assert that `tokenService.generateAuthTokens` was called.","The method returns a valid token pair.",`LoginEmailDto` with valid credentials,Jest,1,US-302
AUTH-U-010,Auth Service,Functional,Unit,High,Yes,"Test failed email login with incorrect password","AuthService is instantiated with mocked dependencies. `userRepository.findByEmail` returns a user. `passwordService.comparePassword` returns `false`.","1. Call `authService.authenticateByEmail` with a `LoginEmailDto` with the wrong password. 2. Assert that the method throws an `UnauthorizedException`.","The method throws an `UnauthorizedException` and `tokenService.generateAuthTokens` is not called.",`LoginEmailDto` with wrong password,Jest,1,US-302
AUTH-S-004,Auth Service,Security,Unit,High,Yes,"Test successful platform login for a new user","AuthService is instantiated with mocked dependencies. `platformTokenValidator.validate` returns a valid payload. `userRepository.findByPlatformId` and `findByEmail` return `null`.","1. Call `authService.authenticateByPlatformToken` with a platform DTO. 2. Assert `platformTokenValidator.validate` is called. 3. Assert `userRepository.create` is called with the platform identity. 4. Assert `tokenService.generateAuthTokens` is called.","A new user is created with the platform identity, and a token pair is returned.",`LoginPlatformDto` with a new user's token,Jest,1.5,US-303
AUTH-S-005,Auth Service,Security,Unit,High,Yes,"Test successful platform login for an existing user","AuthService is instantiated with mocked dependencies. `platformTokenValidator.validate` returns a valid payload. `userRepository.findByPlatformId` returns an existing user.","1. Call `authService.authenticateByPlatformToken` with a platform DTO. 2. Assert `platformTokenValidator.validate` is called. 3. Assert `userRepository.findByPlatformId` is called. 4. Assert `userRepository.create` is NOT called. 5. Assert `tokenService.generateAuthTokens` is called for the found user.","The existing user is found, and a token pair is returned for that user.",`LoginPlatformDto` with an existing user's token,Jest,1,US-303
AUTH-S-006,Auth Service,Security,Unit,High,Yes,"Test platform login that links to an existing email account (Risk R007)","AuthService is instantiated with mocked dependencies. `platformTokenValidator.validate` returns a valid payload with an email. `userRepository.findByPlatformId` returns `null`, but `userRepository.findByEmail` returns an existing user.","1. Call `authService.authenticateByPlatformToken`. 2. Assert `platformTokenValidator.validate` is called. 3. Assert `userRepository.findByPlatformId` is called first. 4. Assert `userRepository.findByEmail` is called next. 5. Assert the existing user is updated with the new platform identity. 6. Assert a new user is NOT created.","The new platform identity is added to the existing user's record, and a token pair is returned.",`LoginPlatformDto` for a new platform but existing email,Jest,2,US-303
AUTH-U-011,Platform Token Validator,Security,Unit,High,Yes,"Test PlatformTokenValidator calls the correct Google SDK method","PlatformTokenValidator is instantiated. `google-auth-library` is mocked.","1. Call `platformTokenValidator.validate('google', 'google-token')`. 2. Assert that the mocked `google-auth-library.verifyIdToken` was called with the correct parameters, including the `GOOGLE_CLIENT_ID` as audience.","The correct Google SDK method is invoked with the correct audience parameter.",Fake Google token string,Jest,1,WI-504
AUTH-U-012,Platform Token Validator,Security,Unit,High,Yes,"Test PlatformTokenValidator calls the correct Apple SDK method","PlatformTokenValidator is instantiated. `node-apple-signin-auth` is mocked.","1. Call `platformTokenValidator.validate('apple', 'apple-token')`. 2. Assert that the mocked `node-apple-signin-auth.verifyIdToken` was called with the correct parameters, including the `APPLE_CLIENT_ID` as audience.","The correct Apple SDK method is invoked with the correct audience parameter.",Fake Apple token string,Jest,1,WI-504
AUTH-S-007,Platform Token Validator,Security,Unit,High,Yes,"Test PlatformTokenValidator throws UnauthorizedException when an SDK validation fails","PlatformTokenValidator is instantiated. An SDK method (e.g., Google's) is mocked to throw an error.","1. Call `platformTokenValidator.validate('google', 'invalid-token')`. 2. Assert that the method throws an `UnauthorizedException`.","The service correctly catches the SDK's error and re-throws a standardized application exception.",Fake invalid token string,Jest,1,WI-504
AUTH-I-001,User Registration,Functional,Integration,High,Yes,"API test for successful user registration","Test database is clean. Server is running.","1. Send a POST request to `/api/v1/auth/register` with a unique email and valid password.","The API returns a 201 Created status. The response body contains `user` and `tokens` objects. A new user record exists in the database.",Unique email and valid password,Supertest,Jest,1.5,US-302
AUTH-I-002,User Registration,Functional,Integration,High,Yes,"API test for registration with an existing email","A user with a known email exists in the test database. Server is running.","1. Send a POST request to `/api/v1/auth/register` with the existing email.","The API returns a 409 Conflict status. The response body contains an appropriate error message.",An existing user's email,Supertest,Jest,1,US-302
AUTH-I-003,User Registration,Functional,Integration,High,Yes,"API test for registration with an invalid DTO (e.g., bad email)","Server is running.","1. Send a POST request to `/api/v1/auth/register` with an invalid email format.","The API returns a 400 Bad Request status. The response body details the validation error.",A string that is not a valid email,Supertest,Jest,1,US-401
AUTH-I-004,Email Login,Functional,Integration,High,Yes,"API test for successful email login","A user with known credentials exists in the test database. Server is running.","1. Send a POST request to `/api/v1/auth/login/email` with the correct credentials.","The API returns a 200 OK status. The response body contains `accessToken` and `refreshToken` strings.",Valid user credentials,Supertest,Jest,1,US-302
AUTH-I-005,Email Login,Functional,Integration,High,Yes,"API test for login with incorrect password","A user with known credentials exists in the test database. Server is running.","1. Send a POST request to `/api/v1/auth/login/email` with the correct email but wrong password.","The API returns a 401 Unauthorized status.",Correct email, wrong password,Supertest,Jest,1,US-302
AUTH-I-006,Token Refresh,Functional,Integration,High,Yes,"API test for successful token refresh","A user is logged in, and a valid refresh token is obtained. Server is running.","1. Send a POST request to `/api/v1/auth/token/refresh` with the valid refresh token.","The API returns a 200 OK status. The response body contains a new `accessToken` and `refreshToken`.",Valid refresh token,Supertest,Jest,1.5,US-304
AUTH-S-008,Token Refresh,Security,Integration,High,Yes,"API test for token refresh with a used/revoked token (Rotation)","A user is logged in, and a valid refresh token is obtained and used once. Server is running.","1. Use a refresh token to get a new token pair. 2. Send another POST request to `/api/v1/auth/token/refresh` with the *original* refresh token.","The API returns a 401 Unauthorized status, demonstrating that the used token was invalidated.",A refresh token that has already been used,Supertest,Jest,2,US-304
AUTH-S-009,Error Handling,Security,Integration,High,Yes,"Verify no stack trace is leaked in production error responses (Risk R011)","Server is running with `NODE_ENV=production`. An endpoint is triggered that causes a server error.","1. Force a 500 error (e.g., by mocking a service to throw a generic Error). 2. Inspect the JSON response body.","The API returns a 500 Internal Server Error status. The response body contains a generic error message and does NOT contain a `stack` property.",N/A,Supertest,Jest,1.5,US-502
AUTH-C-001,CI/CD,Functional,System,High,Yes,"Verify CI pipeline runs tests on push to main","A feature branch with a passing test is created.","1. Create a pull request to `main`. 2. Merge the pull request.","The GitHub Actions CI pipeline is triggered. The 'test' job runs successfully.",A GitHub branch with a new test,GitHub Actions,2,US-604
AUTH-C-002,CI/CD,Functional,System,High,Yes,"Verify CI pipeline fails if tests fail","A feature branch with a failing test is created.","1. Create a pull request to `main`. 2. Merge the pull request.","The GitHub Actions CI pipeline is triggered. The 'test' job fails, causing the entire pipeline run to fail.",A GitHub branch with a failing test,GitHub Actions,1,US-604
AUTH-S-010,CI/CD,Security,System,High,Yes,"Verify CI pipeline fails if `npm audit` finds critical vulnerabilities (Risk R014)","A vulnerable package is temporarily added to `package.json`.","1. Create a pull request to `main` with the vulnerable dependency. 2. Merge the pull request.","The GitHub Actions CI pipeline is triggered. The 'security-scan' job runs `npm audit` and fails, causing the pipeline to fail.",A known vulnerable npm package,GitHub Actions,npm,1.5,WI-605
AUTH-C-003,Containerization,Functional,System,High,Yes,"Verify Docker image builds successfully","The CI pipeline is configured.","1. Trigger the CI pipeline. 2. Observe the 'build-docker' job.","The job completes successfully, building a Docker image without errors.",N/A,Docker,GitHub Actions,1,US-604
AUTH-S-011,Containerization,Security,System,Medium,Yes,"Verify production Docker image does not contain dev dependencies (Risk R013)","The Docker image has been built by the CI pipeline.","1. Run a command to inspect the layers or contents of the final Docker image. 2. `docker run <image> ls /app/node_modules/` and check for a dev-only package like `jest`.","Dev dependencies like `jest` or `ts-node-dev` are not present in the final image's `node_modules`.",Built Docker image,Docker,1,US-604
AUTH-P-001,API Performance,Non-Functional,Performance,High,Yes,"Benchmark POST /login/email endpoint latency","A load testing environment is set up with a populated database.","1. Use a load testing tool (e.g., k6, Artillery) to send requests to `/login/email` at a target rate (e.g., 100 RPS) for 1 minute.","The p99 latency should be less than 150ms. The error rate should be 0%.",10,000+ user records in DB,k6/Artillery,4,US-302
AUTH-P-002,API Performance,Non-Functional,Performance,High,Yes,"Benchmark POST /token/refresh endpoint latency","A load testing environment is set up with a populated database of users and refresh tokens.","1. Use a load testing tool to send requests to `/token/refresh` at a target rate (e.g., 200 RPS) for 1 minute.","The p99 latency should be less than 100ms. The error rate should be 0%.",10,000+ user/token records in DB,k6/Artillery,4,US-304
AUTH-P-003,Database Performance,Non-Functional,Performance,Medium,Yes,"Verify TTL index on Token model is effective","A test script is created to populate the tokens collection.","1. Insert 10,000 token documents with an `expiresAt` value in the near past. 2. Wait for 60-120 seconds. 3. Query the collection for the count of documents.","The document count should be zero (or close to zero), confirming MongoDB's TTL monitor has deleted the expired documents.",N/A,MongoDB Shell/Script,2,US-201