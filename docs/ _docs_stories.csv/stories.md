story_id,epic,title,user_role,description,priority,story_points,dependencies,acceptance_criteria_1,acceptance_criteria_2,acceptance_criteria_3,technical_tasks,definition_of_done
US-MIG-101,"Project Scaffolding and Configuration","Configure Project Dependencies and Scripts","Developer","As a Developer, I want to configure the project's dependencies and CLI scripts in `package.json` so that I have a reproducible environment and standardized commands for managing migrations.","Must Have",5,"","Given the `package.json` is defined, when I run `npm install`, then all required dependencies (`migrate-mongo`, `mongodb`, `dotenv`, `typescript`, etc.) are installed successfully.","Given the `package.json` is configured, when I inspect the 'scripts' section, then the commands `build`, `migrate:create`, `migrate:up`, `migrate:down`, and `migrate:status` are present and correctly configured.","Given the `migrate:create` script is defined, when I run it with an argument (e.g., `npm run migrate:create -- ""my-migration""`), then the argument is correctly passed to the underlying `migrate-mongo` CLI tool.","Create a `package.json` file. Add runtime dependencies (`migrate-mongo`, `mongodb`, `dotenv`). Add development dependencies (`typescript`, `ts-node`, `@types/node`). Define npm scripts for build and migration commands.","The story meets all acceptance criteria. All dependencies are installed and scripts run as expected. The `package.json` file is committed to version control."
US-MIG-102,"Project Scaffolding and Configuration","Configure the TypeScript Compiler","Developer","As a Developer, I want to configure the TypeScript compiler via `tsconfig.json` so that all migration scripts are type-checked and correctly transpiled into executable JavaScript.","Must Have",2,"US-MIG-101","Given the `tsconfig.json` file is created with the specified compiler options (`target: ES2020`, `module: commonjs`, `outDir: ./dist`, `strict: true`), when I run the `npm run build` command, then all `.ts` files in the project compile successfully into the `./dist` directory without errors.","Given the `tsconfig.json` is configured, when I write code in a `.ts` file, then I receive strict type-checking and ES module interop support in my IDE.","","Create a `tsconfig.json` file. Configure compiler options for target, module system, output directory, strictness, and module interoperability. Define the `include` paths to cover all TypeScript source files.","The story meets all acceptance criteria. The `npm run build` command successfully transpiles all TypeScript code. The `tsconfig.json` file is committed to version control."
US-MIG-103,"Project Scaffolding and Configuration","Establish Environment-Agnostic Database Configuration","Developer","As a Developer, I want to create a `migrate-mongo-config.ts` file that sources database credentials from environment variables so that the migration tool can run against different environments (local, staging, prod) without code changes.","Must Have",3,"US-MIG-101","Given a `.env` file with `MIGRATE_MONGO_URI` and `MIGRATE_MONGO_DATABASE_NAME` is present, when the migration tool loads its configuration, then the database connection details are read from these environment variables.","Given the configuration file is loaded, when the migration tool runs, then the database connection details are not hardcoded in the source code.","Given the migration tool runs successfully, when I inspect the database, then a `changelog` collection (or the name specified in `changelogCollectionName`) has been created to store migration history.","Create `migrate-mongo-config.ts`. Use the `dotenv` package to load environment variables. Export a configuration object that reads `MIGRATE_MONGO_URI` and `MIGRATE_MONGO_DATABASE_NAME` from `process.env`. Statically define `migrationsDir` and `changelogCollectionName`.","The story meets all acceptance criteria. The configuration successfully connects to a database using environment variables. The `migrate-mongo-config.ts` file is committed to version control."
US-MIG-201,"Migration Script Implementation","Define Type-Safe Database Collection Interfaces","Developer","As a Developer, I want to define TypeScript interfaces for all database collections so that I can write type-safe migration scripts, reducing errors and improving code readability.","Must Have",5,"","Given the database design specification, when I inspect the `src/types/collections.ts` file, then an exported TypeScript interface exists for each major collection (e.g., `IPlayerProfile`, `ILevel`, `IPlayerScore`).","Given a collection interface (e.g., `IPlayerProfile`), when I compare it to the database design, then its field names and data types (e.g., `username: string`, `_id: ObjectId`) accurately match the specification.","Given I am writing a new migration script, when I import a type from `collections.ts`, then my IDE provides autocompletion and type-checking for that collection's documents.","Create the `src/types/collections.ts` file. Define and export TypeScript interfaces for all collections specified in the database design document. Use types from the `mongodb` driver, such as `ObjectId` and `Date`, where appropriate.","The story meets all acceptance criteria. The `collections.ts` file contains accurate interfaces for all specified database collections and is committed to version control."
US-MIG-202,"Migration Script Implementation","Establish the Initial Database Schema","Developer","As a Developer, I want to implement the initial migration script so that I can establish a reliable, version-controlled baseline for the application's entire database structure.","Must Have",8,"US-MIG-103, US-MIG-201","Given an empty MongoDB database, when I execute the `up` function of the 'initial-schema-setup' migration, then all collections and their corresponding indexes, as defined in the database design, are created successfully.","Given a database with the initial schema, when I execute the `down` function of the 'initial-schema-setup' migration, then all collections created by the `up` function are dropped, returning the database to a clean, empty state.","Given I run the migration's `up` function followed by its `down` function, when I inspect the database, then there are no leftover artifacts from the migration.","Create the `20250520100000-initial-schema-setup.ts` file. In the `up` function, use `db.createCollection()` for all collections and `db.collection().createIndex()` for all simple, compound, and unique indexes. In the `down` function, use `db.collection().drop()` for all created collections.","The story meets all acceptance criteria. The migration can be applied and reverted successfully against a test database. The migration script is committed to version control."
US-MIG-203,"Migration Script Implementation","Add Player Inventory Support to the Schema","Developer","As a Developer, I want to create a migration script to add the `PlayerInventory` collection so that the database schema can support the new player inventory feature.","Must Have",2,"US-MIG-202","Given a database with the initial schema, when I execute the `up` function of the 'add-player-inventory' migration, then the `PlayerInventory` collection is created with its required indexes, including the compound unique index on `{ userId, type, keyName }`.","Given the `PlayerInventory` collection exists, when I execute the `down` function of the migration, then the `PlayerInventory` collection is successfully dropped.","","Create the `20250615120000-add-player-inventory.ts` file. The `up` function must create the `PlayerInventory` collection and its two specified indexes. The `down` function must drop the collection.","The story meets all acceptance criteria. The migration can be applied and reverted successfully. The migration script is committed to version control."
US-MIG-204,"Migration Script Implementation","Add Last Login Tracking to Player Profiles","Developer","As a Developer, I want to create a migration script that adds a `lastLogin` field to the `PlayerProfile` collection so that the application can track player activity.","Must Have",3,"US-MIG-202","Given existing `PlayerProfile` documents without a `lastLogin` field, when I execute the `up` function of the 'add-last-login' migration, then all `PlayerProfile` documents are updated to include a `lastLogin` field, with its value backfilled from the document's `createdAt` field.","Given `PlayerProfile` documents with a `lastLogin` field, when I execute the `down` function of the migration, then the `lastLogin` field is removed from all documents in the collection.","","Create the `20250701093000-add-last-login-to-player-profile.ts` file. The `up` function must use `updateMany()` with an aggregation pipeline to add and backfill the `lastLogin` field. The `down` function must use `updateMany()` with the `$unset` operator to remove the field.","The story meets all acceptance criteria. The data modification and reversal are successful on a test dataset. The migration script is committed to version control."
US-MIG-301,"Documentation and CI/CD Integration","Document Migration Repository Usage","Developer","As a Developer or DevOps Engineer, I want a comprehensive `README.md` file so that I can quickly understand how to use the migration tool locally and integrate it into the CI/CD pipeline.","Should Have",3,"US-MIG-101, US-MIG-103","Given a new team member clones the repository, when they read the `README.md`, then they find clear instructions on the purpose of the repo and how to set up the required environment variables in a local `.env` file.","Given a developer needs to perform a migration task, when they read the `README.md`, then they find a documented list of all `npm run migrate:*` scripts and a clear description of their function.","Given a DevOps engineer needs to automate migrations, when they read the `README.md`, then they find a clear, step-by-step guide on the commands to run in the CI/CD pipeline for applying migrations.","Create a `README.md` file. Document the repository's purpose, required environment variables, local setup instructions, a list of all npm scripts with explanations, and the exact commands needed for CI/CD integration.","The story meets all acceptance criteria. The `README.md` is well-structured, clear, and provides all necessary information for local development and CI/CD integration. The file is committed to version control."