# Sprint Plan: In-App Purchase Validation API

This project is organized into three, two-week sprints. The plan prioritizes building a solid foundation first, then implementing the core business logic and external integrations, and finally, exposing the API and performing comprehensive quality assurance and operational readiness.

### **Team Capacity Assumptions:**

*   **Team Size:** 2-3 Backend Developers
*   **Sprint Duration:** 2 Weeks
*   **Sprint Capacity:** ~80-100 hours per sprint

---

### **Sprint 1: Foundation & Data Model (Capacity: ~73 hours)**

*   **Goal:** Establish a runnable, configured application that can connect to a database. All core data models and repository patterns for persistence will be in place. This sprint delivers the architectural bedrock.
*   **Demo:** Showcase the running application connecting to a test MongoDB instance. Demonstrate the creation of an `IAPTransaction` record in the database using a test script, and show the successful creation of an `AuditLog` entry.
*   **Stories:** US-001, US-002, US-003, US-004, US-005, US-006, US-007.

### **Sprint 2: Business Logic & External Integration (Capacity: ~90 hours)**

*   **Goal:** Implement the complete end-to-end business logic for validating a purchase. This includes integrating with the live Apple and Google sandbox environments. By the end of this sprint, the core service can successfully validate a real test receipt.
*   **Demo:** Execute a test script that invokes the `IapValidationService` with a real sandbox receipt (for both Apple and Google). Show the logs of the service communicating with the external platform, identifying the transaction as new, granting mock items, and updating the transaction status to 'validated' in the database. Demonstrate the replay attack logic by running the same receipt twice.
*   **Stories:** US-008, US-009, US-010, US-011.

### **Sprint 3: API Exposure, QA & Deployment Prep (Capacity: ~112 hours)**

*   **Goal:** Expose the feature via a secure, public-facing API endpoint. Harden the entire service with comprehensive unit, integration, and E2E tests. Prepare the application for deployment by containerizing it. This sprint makes the feature production-ready.
*   **Demo:** Using an API client like Postman, make a live, authenticated call to the deployed `POST /api/iap/validate` endpoint. Demonstrate the 400-level error for a malformed request and a 200 OK for a valid request. Show the final code coverage report from the CI pipeline. Build and run the production Docker container locally.
*   **Stories:** US-012, US-013, US-014, US-015, US-016.

---

Title,Description,Type,Status,Priority,Assignee,Reporter,Due Date,Estimate,Labels,Sprint,Epic,Project,Attachments,Comments,Parent ID,Dependencies,Created At,Updated At,Skills Required
"US-001: Establish the Node.js/TypeScript Project Foundation","As a Developer, I want a standardized project setup with all necessary dependencies and a TypeScript compiler configuration, so that I can start building features quickly in a consistent and stable environment.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.7,"setup,config","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","","GIVEN a new project is cloned, WHEN I run `npm install`, THEN all production and development dependencies are installed successfully. | GIVEN the project has TypeScript source files in the `src` directory, WHEN I run the `npm run build` script, THEN the files are transpiled into JavaScript in the `dist` directory without errors. | GIVEN the project is running in development mode via `npm run dev`, WHEN I make a change to a source TypeScript file, THEN the server automatically restarts.","","","2024-05-20 10:00","2024-05-20 10:00","Node.js,TypeScript,npm"
"TASK-IAP-001-01: Create package.json and install dependencies","Initialize the npm project and add all production and development dependencies specified in WI-IAP-001. Define the `start`, `build`, and `dev` scripts.","Configuration","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",3,"setup,config","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","package.json,package-lock.json","`package.json` file is created and lists all required dependencies. | `npm install` runs without errors. | `npm run build` command is present.","US-001","","2024-05-20 10:00","2024-05-20 10:00","npm,Node.js"
"TASK-IAP-002-01: Create and configure tsconfig.json","Set up the `tsconfig.json` file with options for target, module, directories, and strict type checking suitable for a Node.js Express application.","Configuration","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",3.7,"setup,config,typescript","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","tsconfig.json","`tsconfig.json` is created with specified compiler options. | Running `tsc` (via `npm run build`) transpiles `.ts` files from `src` to `.js` files in `dist`.","US-001","TASK-IAP-001-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript"
"US-002: Manage Application Configuration and Secrets","As a Developer, I want a secure and straightforward way to manage environment variables for different environments (local, production), so that I can configure the application without hardcoding secrets into the source code.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",4.5,"config,security","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","","GIVEN the application requires a database connection string, WHEN it starts in a local development environment with a `.env` file, THEN it correctly loads the `MONGO_DB_CONNECTION_STRING` value from the file. | GIVEN the application is running in a production environment, WHEN environment variables are set directly in that environment, THEN the application correctly reads those variables without needing a `.env` file. | GIVEN a new developer is setting up the project, WHEN they look at the repository, THEN they find a `.env.example` file that lists all the required configuration variables.","","TASK-IAP-001-01","2024-05-20 10:00","2024-05-20 10:00","Node.js,Security,Git"
"TASK-IAP-003-01: Implement environment variable loader and create example file","Use the `dotenv` library to load variables from a `.env` file during local development. Create a `.env.example` file listing all required variables. Ensure `.env` is added to `.gitignore`.","Configuration","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",4.5,"config,security,setup","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP",".env.example,.gitignore update","Application can access environment variables via `process.env`. | `.env.example` file is committed and lists all keys from the SDS. | `.gitignore` file contains an entry for `.env`.","US-002","TASK-IAP-001-01","2024-05-20 10:00","2024-05-20 10:00","Node.js,Security,Git"
"US-003: Establish a Robust Database Connection","As a Developer, I want the application to reliably connect to the MongoDB database on startup, so that data can be persisted and retrieved for application functionality.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",10.1,"database,resilience","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","","GIVEN a valid `MONGO_DB_CONNECTION_STRING` is provided in the environment, WHEN the application starts, THEN it successfully establishes a connection to the MongoDB server. | GIVEN an invalid `MONGO_DB_CONNECTION_STRING` is provided, WHEN the application starts, THEN it logs a clear connection error message and exits gracefully. | GIVEN the database is temporarily unavailable during startup, WHEN the application starts, THEN it attempts to reconnect according to a defined retry logic.","","TASK-IAP-003-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,Node.js,Error Handling"
"TASK-IAP-004-01: Implement basic Mongoose connection logic","Create a database connector module that uses Mongoose to connect to the MongoDB instance specified by the `MONGO_DB_CONNECTION_STRING` environment variable. Implement logging for successful connection and initial connection errors.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",4.2,"database,mongoose,infrastructure","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","src/core/database/mongo.connector.ts (initial version)","On successful connection, a log message is printed. | On connection failure, an error is logged and the process exits.","US-003","TASK-IAP-003-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,Node.js,TypeScript"
"TASK-IAP-004-02: Implement robust connection event handling and retry logic","Enhance the Mongoose connector to handle `disconnected` and `error` events after the initial connection. Implement an exponential backoff retry mechanism for reconnections.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6,"database,mongoose,resilience","Sprint 1","EPIC-IAP-01: Project Scaffolding and Core Infrastructure","REPO-GLYPH-IAP","src/core/database/mongo.connector.ts (final version)","The application logs but does not crash if the database connection is lost after startup. | The application attempts to reconnect to the database automatically if the connection is lost. | Connection event listeners for `connected`, `error`, and `disconnected` are implemented.","US-003","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,Node.js,Error Handling"
"US-004: Define the IAP Transaction Data Model","As a Developer, I want to define a precise and secure Mongoose schema for IAP transactions, so that all purchase data is stored consistently and replay attacks are prevented at the database level.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",7,"database,model,security","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","","GIVEN the IAP Transaction schema is defined, WHEN I review it, THEN it contains all fields as specified in the SDS, including `userId`, `platform`, `platformTransactionId`, and `validationStatus`. | GIVEN a new transaction is created for Android with transaction ID 'TX123', WHEN another transaction for Android with the same ID 'TX123' is attempted, THEN the database rejects the insertion due to the compound unique index violation. | GIVEN a new transaction is created for Android with transaction ID 'TX123', WHEN another transaction is attempted for iOS with the same ID 'TX123', THEN the database allows the insertion as the platform is different.","","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,MongoDB,TypeScript"
"TASK-IAP-010-01: Implement IAPTransaction Mongoose schema and model","Create the `iapTransactionSchema` in `iapTransaction.model.ts`. Define all fields, types, and constraints as per the SDS. Critically, define the compound unique index on `platform` and `platformTransactionId`.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",7,"database,model,mongoose,security","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","src/core/domain/iapTransaction.model.ts","Mongoose schema is created matching the SDS field-for-field. | The compound unique index `{ platform: 1, platformTransactionId: 1 }` is defined in the schema options. | A typed Mongoose model `IapTransactionModel` is created and exported.","US-004","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,TypeScript,MongoDB"
"US-005: Abstract IAP Transaction Database Operations","As a Developer, I want a dedicated repository to handle all data access for IAP transactions, so that the application logic is decoupled from the database implementation and is easier to test and maintain.","User Story","Backlog","High","backend_dev@glyphweaver.com","pm@glyphweaver.com","",7,"database,repository","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","","GIVEN an IAP transaction for a specific platform and transaction ID exists in the database, WHEN the `findByPlatformTransactionId` method is called with those details, THEN it returns the corresponding transaction document. | GIVEN a new transaction needs to be recorded, WHEN the `create` method is called with the transaction data, THEN a new document is created in the `iaptransactions` collection with a 'pending' status. | GIVEN an existing transaction record needs its status updated, WHEN the `update` method is called with the document ID and new status, THEN the corresponding document in the database is updated correctly.","","TASK-IAP-010-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Mongoose,Repository Pattern"
"TASK-IAP-011-01: Implement IapTransactionRepository","Create the `IapTransactionRepository` class. It should depend on the `IapTransactionModel`. Implement the `findByPlatformTransactionId`, `create`, and `update` methods to perform the underlying Mongoose queries.","Development","Backlog","High","backend_dev@glyphweaver.com","pm@glyphweaver.com","",7,"database,repository,data-access","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","src/core/repositories/iapTransaction.repository.ts","The class is created and injectable. | `findByPlatformTransactionId` method uses `findOne` with the correct query object. | `create` method creates a new document and saves it. | `update` method uses `findByIdAndUpdate` to modify an existing document.","US-005","TASK-IAP-010-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Mongoose,Repository Pattern"
"US-006: Atomically Grant Items to Player Inventory","As a Player, I want the items I purchase to be added to my inventory reliably and without error, so that I never lose items due to system glitches or concurrent requests.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",11.5,"database,concurrency,critical","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","","GIVEN a player has successfully validated a purchase for 100 coins, WHEN the `grantItemsToPlayer` method is called, THEN the player's coin balance in the inventory is atomically incremented by 100. | GIVEN a player is purchasing an item type they have never owned before, WHEN the `grantItemsToPlayer` method is called, THEN a new inventory entry for that item is created for the player with the correct quantity. | GIVEN two separate valid purchases for the same player are processed almost simultaneously, WHEN the `grantItemsToPlayer` method is called for both, THEN the final inventory count reflects the sum of both grants, with no items lost.","","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,MongoDB,TypeScript"
"TASK-IAP-012-01: Implement PlayerInventoryRepository with atomic updates","Create the `PlayerInventoryRepository` class. Implement the `grantItemsToPlayer` method using Mongoose's `findOneAndUpdate`. The update operation must use the `$inc` operator for quantity and set `upsert: true` to handle new inventory items. The method will need to iterate over an array of items to grant.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",11.5,"database,repository,concurrency,critical","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","src/core/repositories/playerInventory.repository.ts","The method correctly uses `findOneAndUpdate` in a loop for each item to grant. | The MongoDB update query uses the `$inc` operator. | The MongoDB update query uses the `upsert: true` option. | The operation is verifiably atomic and idempotent.","US-006","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,MongoDB,TypeScript"
"US-007: Log Critical System and Security Events","As a Security Admin, I need a detailed audit trail of all IAP validation events, so that I can investigate fraudulent activity, support customer issues, and ensure system accountability.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",13,"logging,audit","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","","GIVEN a successful IAP validation occurs for a user, WHEN the `logEvent` method is called, THEN a new document is created in the `auditlogs` collection with eventType 'iap_validation_success' and the relevant user and transaction details. | GIVEN a replay attack is detected, WHEN the `logEvent` method is called, THEN a new document is created in the `auditlogs` collection with eventType 'iap_replay_attempt' and details of the attempt. | GIVEN a validation fails for any other reason, WHEN the `logEvent` method is called, THEN a new document is created with an appropriate eventType (e.g., 'iap_validation_failed') and failure details.","","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,TypeScript,Jest,Mocking"
"TASK-IAP-013-01: Define AuditLog Mongoose model","Create the Mongoose schema and model for the `auditlogs` collection. It should include `eventType`, `userId`, `details`, and a `timestamp`.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",3,"database,model,logging,audit","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","src/core/domain/auditLog.model.ts","`auditLog.model.ts` file is created. | The schema matches the specification. | The model is exported.","US-007","TASK-IAP-004-01","2024-05-20 10:00","2024-05-20 10:00","Mongoose,TypeScript"
"TASK-IAP-013-02: Implement injectable AuditLogService","Create the `AuditLogService` class that takes the `AuditLog` model as a dependency. Implement the public `logEvent` method which creates and saves a new audit log document.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6,"service,logging,audit","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","src/core/services/audit.service.ts","`audit.service.ts` file is created. | The `logEvent` method correctly creates a document in the `auditlogs` collection. | The service is designed to be injectable.","US-007","TASK-IAP-013-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Mongoose"
"TASK-IAP-013-03: Unit test AuditLogService","Write unit tests for the `AuditLogService`. The Mongoose model's `create` or `save` method should be mocked to verify it's called with the correct data, without hitting a real database.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",4,"test,unit-test","Sprint 1","EPIC-IAP-02: Domain Modeling and Data Persistence","REPO-GLYPH-IAP","src/core/services/audit.service.test.ts","Unit test file `audit.service.test.ts` is created. | The test verifies that the model's `create` method is called once. | The test asserts that the payload passed to `create` matches the input to `logEvent`.","US-007","TASK-IAP-013-02","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking"
"US-009: Validate Apple App Store Receipts","As an iOS Player, I want my in-app purchases to be verified with Apple's servers, so that I can be confident my transaction is secure and my purchased content will be granted.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",19.5,"gateway,integration,apple","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","","GIVEN a valid iOS receipt string is provided, WHEN the `AppleIapGateway.validate` method is called, THEN it communicates with Apple's servers and returns an object with `isValid: true` and the correct transaction ID and SKU. | GIVEN an invalid or malformed iOS receipt string is provided, WHEN the `AppleIapGateway.validate` method is called, THEN it returns an object with `isValid: false`. | GIVEN the `APPLE_IAP_SHARED_SECRET` is configured in the environment, WHEN the gateway is initialized, THEN it uses this secret for its validation calls.","","TASK-IAP-003-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,API Integration,apple-receipt-verify,Jest,Mocking"
"TASK-IAP-021-01: Implement AppleIapGateway using apple-receipt-verify","Create the `AppleIapGateway` class implementing `IPlatformIapGateway`. It will use the `apple-receipt-verify` library. The `validate` method should initialize the library, call its verification function, and handle the response by checking the status code and parsing the receipt data to extract the transaction ID and product ID.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",12.8,"gateway,integration,apple,iap","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","src/iap/infrastructure/gateways/apple.gateway.ts","The class is created and implements the gateway interface. | The `validate` method uses `apple-receipt-verify`. | It correctly reads `APPLE_IAP_SHARED_SECRET` from the environment. | It correctly normalizes the Apple response (or error) into the standard `{ isValid, transactionId, ... }` object.","US-009","TASK-IAP-003-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,API Integration,apple-receipt-verify"
"TASK-IAP-021-02: Unit test AppleIapGateway","Write unit tests for `AppleIapGateway`. Mock the `apple-receipt-verify` library to simulate various responses from Apple: success (status 0), invalid receipt (e.g., status 21002), and other errors. Verify the gateway normalizes these responses correctly.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.7,"test,unit-test,gateway,apple","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","src/iap/infrastructure/gateways/apple.gateway.test.ts","Tests cover a successful validation scenario. | Tests cover at least two different failure scenarios (e.g., invalid receipt, sandbox receipt sent to prod). | The `apple-receipt-verify` library is fully mocked.","US-009","TASK-IAP-021-01","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking"
"US-010: Validate Google Play Store Purchases","As an Android Player, I want my in-app purchases to be verified with Google's servers, so that I can be confident my transaction is secure and my purchased content will be granted.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",19.5,"gateway,integration,google","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","","GIVEN a valid Google Play purchase token and SKU are provided, WHEN the `GoogleIapGateway.validate` method is called, THEN it communicates with the Google Play Developer API and returns an object with `isValid: true` and the correct transaction ID (orderId). | GIVEN an invalid or already consumed Google Play token is provided, WHEN the `GoogleIapGateway.validate` method is called, THEN it returns an object with `isValid: false`. | GIVEN the `GOOGLE_SERVICE_ACCOUNT_BASE64` and `GOOGLE_PACKAGE_NAME` are configured, WHEN the gateway is initialized, THEN it uses these credentials for its validation calls.","","TASK-IAP-003-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,API Integration,google-play-billing,Google Cloud,Jest,Mocking"
"TASK-IAP-022-01: Implement GoogleIapGateway using google-play-billing","Create the `GoogleIapGateway` class implementing `IPlatformIapGateway`. It will use the `google-play-billing` library. The `validate` method must initialize the library with Base64-decoded service account credentials, call `verifyPurchase`, and handle the response by checking `purchaseState` and extracting the `orderId`.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",12.8,"gateway,integration,google,iap","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","src/iap/infrastructure/gateways/google.gateway.ts","The class is created and implements the gateway interface. | The `validate` method uses `google-play-billing`. | It correctly decodes and uses `GOOGLE_SERVICE_ACCOUNT_BASE64`. | It correctly normalizes the Google response (or error) into the standard `{ isValid, transactionId, ... }` object.","US-010","TASK-IAP-003-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,API Integration,google-play-billing,Google Cloud"
"TASK-IAP-022-02: Unit test GoogleIapGateway","Write unit tests for `GoogleIapGateway`. Mock the `google-play-billing` library to simulate various responses from Google: success (purchaseState 0), already consumed purchase, and API errors. Verify the gateway normalizes these responses correctly.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.7,"test,unit-test,gateway,google","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","src/iap/infrastructure/gateways/google.gateway.test.ts","Tests cover a successful validation scenario. | Tests cover at least two different failure scenarios (e.g., invalid token, purchase state is not 0). | The `google-play-billing` library is fully mocked.","US-010","TASK-IAP-022-01","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking"
"US-008: Abstract Platform-Specific Validation Logic","As a Developer, I want a common interface for validating receipts from different platforms (Apple/Google), so that the core application logic can remain platform-agnostic, making it cleaner and easier to extend.","User Story","Backlog","High","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.3,"design-pattern,factory,strategy","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","","GIVEN the core service needs to validate a receipt, WHEN it requests a gateway from the `PlatformGatewayFactory` with the platform 'ios', THEN it receives an instance of the `AppleIapGateway`. | GIVEN the core service needs to validate a receipt, WHEN it requests a gateway from the `PlatformGatewayFactory` with the platform 'android', THEN it receives an instance of the `GoogleIapGateway`. | GIVEN both `AppleIapGateway` and `GoogleIapGateway` exist, WHEN I inspect their class definitions, THEN both correctly implement the `IPlatformIapGateway` interface and its `validate` method.","","TASK-IAP-021-01,TASK-IAP-022-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Design Patterns"
"TASK-IAP-020-01: Define IPlatformIapGateway interface and PlatformGatewayFactory","Create the `IPlatformIapGateway` interface defining the `validate` method contract. Implement the `PlatformGatewayFactory` that depends on the concrete gateway implementations and has a `getGateway` method to return the correct one based on a platform string.","Development","Backlog","High","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.3,"gateway,design-pattern,factory,strategy","Sprint 2","EPIC-IAP-03: Platform Validation Gateway Implementation","REPO-GLYPH-IAP","src/iap/infrastructure/gateways/platform.gateway.ts","`platform.gateway.ts` exists with the `IPlatformIapGateway` interface. | The `PlatformGatewayFactory` has a `getGateway` method. | The method returns the correct gateway instance for 'ios' and 'android' inputs.","US-008","TASK-IAP-021-01,TASK-IAP-022-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Design Patterns"
"US-011: Orchestrate the End-to-End Purchase Validation","As a Player, I want my in-app purchase to be processed securely from end-to-end, so that the system verifies my receipt, protects against fraud, and grants my items in a single, reliable operation.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",27.2,"orchestration,business-logic","Sprint 2","EPIC-IAP-04: Core Application Logic","REPO-GLYPH-IAP","","GIVEN a player submits a new, valid receipt, WHEN the `IapValidationService.validatePurchase` method is called, THEN the service validates the receipt with the correct platform gateway, checks for replays, creates a transaction record, grants items, updates the transaction to 'validated', logs the success, and returns a success response. | GIVEN a player submits a receipt that has already been processed, WHEN the `validatePurchase` method is called, THEN the service identifies it as a replay attack via the repository, logs the attempt, and returns a failure response without granting items. | GIVEN a player submits a valid, new receipt but the item granting step fails, WHEN the `validatePurchase` method is called, THEN the service catches the error, updates the transaction record's status to 'failed', logs the failure, and returns an error response.","","TASK-IAP-020-01,TASK-IAP-011-01,TASK-IAP-012-01,TASK-IAP-013-02","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Business Logic,Security,Error Handling"
"TASK-IAP-030-01: Scaffold IapValidationService and inject dependencies","Create the `IapValidationService` class file. Set up the constructor to inject dependencies: `PlatformGatewayFactory`, `IapTransactionRepository`, `PlayerInventoryRepository`, and `IAuditLogService`.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",3,"service,architecture","Sprint 2","EPIC-IAP-04: Core Application Logic","REPO-GLYPH-IAP","src/iap/application/iap.service.ts (skeleton)","The `IapValidationService` class is created. | The constructor correctly defines and assigns the required dependencies. | The service is designed to be injectable.","US-011","TASK-IAP-020-01,TASK-IAP-011-01,TASK-IAP-012-01,TASK-IAP-013-02","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Design Patterns"
"TASK-IAP-030-02: Implement service logic for the happy path","In `validatePurchase`, implement the successful flow: get gateway, validate receipt, check for replay (expecting none), create pending transaction, grant items, update transaction to 'validated', log success, and return success.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",8.3,"service,business-logic,orchestration","Sprint 2","EPIC-IAP-04: Core Application Logic","REPO-GLYPH-IAP","src/iap/application/iap.service.ts (happy path logic)","The service correctly calls the gateway's validate method. | It calls the `IapTransactionRepository.create` method. | It calls the `PlayerInventoryRepository.grantItemsToPlayer` method. | It calls the `IapTransactionRepository.update` method to set status to 'validated'. | It calls the `AuditLogService.logEvent` with a success message.","US-011","TASK-IAP-030-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Business Logic"
"TASK-IAP-030-03: Implement service logic for replay attack rejection","In `validatePurchase`, after a successful external validation, use `IapTransactionRepository.findByPlatformTransactionId`. If a transaction is found, immediately log a 'replay attack' audit event and return a failure response.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",5.2,"service,business-logic,security,fraud-prevention","Sprint 2","EPIC-IAP-04: Core Application Logic","REPO-GLYPH-IAP","src/iap/application/iap.service.ts (replay attack logic)","The service calls `findByPlatformTransactionId` after external validation. | If a transaction is returned, no items are granted. | A specific audit log for a replay attempt is created. | A clear failure message is returned to the caller.","US-011","TASK-IAP-030-01","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Business Logic,Security"
"TASK-IAP-030-04: Implement robust try-catch for fulfillment failure","Wrap the fulfillment process (create pending transaction, grant items, update to validated) in a `try...catch` block. In the `catch` block, if a pending transaction was created, update its status to 'failed' and log a detailed failure audit event.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",10.7,"service,business-logic,error-handling,resilience","Sprint 2","EPIC-IAP-04: Core Application Logic","REPO-GLYPH-IAP","src/iap/application/iap.service.ts (error handling logic)","A `try...catch` block surrounds the fulfillment steps. | If `grantItemsToPlayer` throws an error, the `catch` block is executed. | The `catch` block calls `IapTransactionRepository.update` to set the status to 'failed'. | A detailed failure audit event is logged.","US-011","TASK-IAP-030-02","2024-05-20 10:00","2024-05-20 10:00","TypeScript,Error Handling"
"US-012: Define a Clear and Validated API Contract","As a Client Developer, I need a well-defined and strictly validated API contract for submitting IAP receipts, so that I can integrate with confidence and get clear feedback on malformed requests.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",10.7,"api,validation,contract","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","","GIVEN I am creating a request for the IAP validation endpoint, WHEN I consult the DTO file, THEN I can clearly see the required structure for both iOS (`receiptData` as a string) and Android (`receiptData` as an object). | GIVEN I send a request for 'ios' but provide an object for `receiptData`, WHEN the request hits the server, THEN it is rejected with a 400 Bad Request and a descriptive validation error. | GIVEN I send a request with the `platform` field missing, WHEN the request hits the server, THEN it is rejected with a 400 Bad Request and a descriptive validation error.","","","2024-05-20 10:00","2024-05-20 10:00","TypeScript,joi,Jest"
"TASK-IAP-040-01: Define ValidateIap DTOs","Create the `src/iap/presentation/dtos/validateIap.dto.ts` file. Define and export TypeScript interfaces or classes for `ValidateIapRequestDto` and `ValidateIapResponseDto` as per the SDS.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",2,"api,dto,contract","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","src/iap/presentation/dtos/validateIap.dto.ts","The file is created. | `ValidateIapRequestDto` has `platform` and `receiptData` fields with correct types. | `ValidateIapResponseDto` has `success` and `message` fields.","US-012","","2024-05-20 10:00","2024-05-20 10:00","TypeScript"
"TASK-IAP-041-01: Implement Joi validation schema with conditional logic","Create the `validateIap.validator.ts` file. Use the `joi` library to build a schema that validates the `ValidateIapRequestDto`. This must include using `Joi.when('platform', ...)` to enforce that `receiptData` is a string for 'ios' and an object for 'android'.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",5.2,"api,validation,joi,security","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","src/iap/presentation/validators/validateIap.validator.ts","The Joi schema is created and exported. | The schema correctly uses conditional validation for `receiptData`. | The schema validates all fields as required. | The schema rejects invalid structures.","US-012","TASK-IAP-040-01","2024-05-20 10:00","2024-05-20 10:00","joi,TypeScript"
"TASK-IAP-041-02: Unit test the Joi validator schema","Create a test file for `validateIap.validator.ts`. Write test cases that assert the schema's behavior with valid iOS inputs, valid Android inputs, and various invalid inputs (e.g., missing platform, mismatched receiptData type).","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",3.5,"test,unit-test,validation","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","src/iap/presentation/validators/validateIap.validator.test.ts","A test file for the validator exists. | At least one valid iOS and one valid Android payload pass validation. | At least three different invalid payloads fail validation with expected error messages.","US-012","TASK-IAP-041-01","2024-05-20 10:00","2024-05-20 10:00","joi,Jest"
"US-013: Expose the IAP Validation Logic via a Secure API Endpoint","As a Client Developer, I want to send purchase receipts to a secure, authenticated API endpoint, so that I can trigger the server-side validation process for a specific user.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",16.5,"api,express,routing","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","","GIVEN a client sends a valid POST request to the `/iap/validate` endpoint with a valid auth token and request body, WHEN the request is processed, THEN the `IapController` calls the `IapValidationService` and returns a 200 OK response with the result. | GIVEN a client sends a POST request to `/iap/validate` without a valid authentication token, WHEN the request is processed, THEN it is rejected with a 401 Unauthorized status before hitting the controller logic. | GIVEN a client sends a POST request to `/iap/validate` with an invalid body structure, WHEN the request is processed, THEN it is rejected by the validation middleware with a 400 Bad Request status.","","TASK-IAP-030-01,TASK-IAP-041-01","2024-05-20 10:00","2024-05-20 10:00","Express.js,TypeScript,Jest,Mocking"
"TASK-IAP-042-01: Implement IapController","Create the `IapController` class. It will be injected with the `IapValidationService`. Implement the `validate` method to handle the request/response cycle. It must extract `userId` (from auth middleware) and the request body, call the service, and send a JSON response with the appropriate status code.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6,"api,controller,express","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","src/iap/presentation/iap.controller.ts","`iap.controller.ts` is created. | The `validate` method calls `this._iapValidationService.validatePurchase`. | A success from the service returns a 200 status. | A failure from the service returns a 400 status. | Unexpected errors are passed to `next()`.","US-013","TASK-IAP-030-01","2024-05-20 10:00","2024-05-20 10:00","Express.js,TypeScript"
"TASK-IAP-043-01: Configure IAP Express router and middleware pipeline","Create `iap.routes.ts`. Instantiate an Express `Router`. Define the `POST /validate` route and apply the middleware chain in the correct order: `authMiddleware`, `validationMiddleware(validateIapValidator)`, `iapController.validate`.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.3,"api,routing,express,middleware","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","src/iap/presentation/iap.routes.ts","`iap.routes.ts` is created and exports an Express Router. | The `POST /validate` route is defined. | The middleware pipeline is ordered correctly.","US-013","TASK-IAP-041-01,TASK-IAP-042-01","2024-05-20 10:00","2024-05-20 10:00","Express.js,TypeScript"
"TASK-IAP-043-02: Integrate IAP router into main Express app","In the main application entry point (e.g., `src/app.ts` or `src/server.ts`), import the IAP router and mount it on a base path, like `/api/iap`.","Development","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",2,"api,routing,express","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","Updated main application file (e.g., `src/app.ts`)","The main app file imports the IAP router. | The app uses the router with a base path, e.g., `app.use('/api/iap', iapRouter)`. | The full endpoint is now accessible at `POST /api/iap/validate`.","US-013","TASK-IAP-043-01","2024-05-20 10:00","2024-05-20 10:00","Express.js"
"TASK-IAP-043-03: Unit test IapController","Write unit tests for the IapController. The IapValidationService must be mocked. Test that the controller calls the service with the correct arguments (`userId`, `body`) and that it correctly handles the `success: true` and `success: false` responses from the service by sending the appropriate status codes.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",4,"test,unit-test,controller","Sprint 3","EPIC-IAP-05: API Presentation Layer","REPO-GLYPH-IAP","src/iap/presentation/iap.controller.test.ts","The IapValidationService is mocked. | One test simulates a successful service call and asserts a 200 response. | One test simulates a failed service call and asserts a 400 response. | One test simulates the service throwing an error and asserts the `next` function is called.","US-013","TASK-IAP-042-01","2024-05-20 10:00","2024-05-20 10:00","Jest,Express.js,Mocking"
"US-014: Ensure Component Logic is Correct with Unit Tests","As a Developer, I want comprehensive unit tests for all services, gateways, and repositories, so that I can refactor code with confidence and ensure each component behaves as expected in isolation.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",33.7,"test,unit-test,qa","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","","GIVEN the `IapValidationService` unit tests, WHEN they are run, THEN all dependencies like repositories and gateways are mocked, and the tests verify the service's orchestration logic for success, replay, and failure scenarios. | GIVEN the `AppleIapGateway` unit tests, WHEN they are run, THEN the `apple-receipt-verify` library is mocked to simulate valid and invalid responses from Apple, and the gateway's parsing logic is verified. | GIVEN the repository unit tests, WHEN they are run, THEN the Mongoose models are mocked to verify that the repository methods are calling the correct database functions with the correct parameters.","","TASK-IAP-011-01,TASK-IAP-012-01,TASK-IAP-030-04,TASK-IAP-020-01","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking,Mongoose"
"TASK-IAP-050-04: Set up Jest configuration and test scripts","Configure Jest for the TypeScript project. This includes setting up `jest.config.js` to use `ts-jest` for transpilation, defining `testEnvironment` as 'node', and setting up coverage reporting. Add a `test` script to `package.json`.","Configuration","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",4.2,"test,config,jest","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","jest.config.js,Updated `package.json`","`jest.config.js` is created and configured. | The `npm test` script runs all `*.test.ts` files. | A code coverage report is generated after the test run.","US-014","TASK-IAP-001-01","2024-05-20 10:00","2024-05-20 10:00","Jest,npm"
"TASK-IAP-050-01: Unit test Repositories (IAP & Inventory)","Write unit tests for `IapTransactionRepository` and `PlayerInventoryRepository`. The respective Mongoose models must be mocked to avoid any database connection. Verify that the repository methods call the correct Mongoose static/instance methods (e.g., `findOne`, `create`, `findOneAndUpdate`) with the expected arguments.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",10.3,"test,unit-test,repository","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","src/core/repositories/iapTransaction.repository.test.ts,src/core/repositories/playerInventory.repository.test.ts","Test files `iapTransaction.repository.test.ts` and `playerInventory.repository.test.ts` are created. | Mongoose models are mocked using `jest.mock()`. | Tests assert that methods like `findOne` and `findOneAndUpdate` are called with the correct query objects and operators (`$inc`).","US-014","TASK-IAP-011-01,TASK-IAP-012-01","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking,Mongoose"
"TASK-IAP-050-02: Unit test IapValidationService","Write extensive unit tests for `IapValidationService`. All injected dependencies (gateways, repositories, logger) must be mocked. Create test cases for the full success path, replay attack detection, external validation failure, and item grant failure.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",16,"test,unit-test,service","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","src/iap/application/iap.service.test.ts","`iap.service.test.ts` is created. | All dependencies are mocked. | Test case for happy path asserts all mocked methods are called in the correct order. | Test case for replay attack asserts `grantItems` is not called and a failure is returned. | Test case for fulfillment failure asserts the transaction status is updated to 'failed'.","US-014","TASK-IAP-030-04","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking"
"TASK-IAP-050-03: Unit test PlatformGatewayFactory","Write unit tests for `PlatformGatewayFactory`. Mock the concrete gateway classes. Assert that calling `getGateway('ios')` returns a mocked `AppleIapGateway` instance and `getGateway('android')` returns a mocked `GoogleIapGateway` instance.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",3,"test,unit-test,factory","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","src/iap/infrastructure/gateways/platform.gateway.test.ts","`platform.gateway.test.ts` is created. | `AppleIapGateway` and `GoogleIapGateway` are mocked. | Tests verify the correct instance is returned for each platform string.","US-014","TASK-IAP-020-01","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,Mocking"
"US-015: Verify the End-to-End Validation Flow with Integration Tests","As a Developer, I want integration tests that cover the full IAP validation flow from the service layer to the database, so that I can be confident the components work together correctly.","User Story","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",41.3,"test,integration-test,qa","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","","GIVEN the integration test suite is run against a test database, WHEN a test simulates a valid new purchase, THEN it verifies that a new transaction record is created in the database with a 'validated' status and the player inventory is updated correctly. | GIVEN a transaction ID is first added to the test database, WHEN an integration test attempts to validate the same transaction ID again, THEN the test asserts that the service correctly identifies the replay and no new items are granted. | GIVEN the integration test suite mocks the `PlayerInventoryRepository` to throw an error, WHEN a test simulates a valid purchase, THEN it asserts that the transaction record in the database is correctly marked with a 'failed' status.","","TASK-IAP-050-04,TASK-IAP-030-04,TASK-IAP-043-02","2024-05-20 10:00","2024-05-20 10:00","Jest,MongoDB,Docker,Supertest,Express.js"
"TASK-IAP-051-01: Set up integration test environment with in-memory/containerized DB","Configure the test suite to connect to a separate test database for integration tests. This often involves using a library like `mongodb-memory-server` or scripting `docker-compose` to spin up a MongoDB container for the test run. Implement `beforeEach` and `afterEach` hooks to clean the database between tests.","Configuration","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",9.3,"test,integration-test,config,database","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","Test helper files for database setup/teardown.","The integration test suite connects to a test-specific database. | The database is cleared before each test runs to ensure isolation. | The connection to the test database is properly torn down after the suite finishes.","US-015","TASK-IAP-050-04","2024-05-20 10:00","2024-05-20 10:00","Jest,MongoDB,Docker"
"TASK-IAP-051-02: Write integration test for happy path and replay attack","Create an integration test for `IapValidationService`. Mock the platform gateways to return a valid response. First, run the test for a new transaction and assert that the `IAPTransaction` and `PlayerInventory` collections are updated correctly. Second, run the validation for the same transaction ID again and assert that no further changes are made to the database and a failure is returned.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",14.3,"test,integration-test,security","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","__tests__/integration/iap.integration.test.ts (partial)","Platform gateways are mocked. | Test connects to a real test DB. | The happy path test asserts a 'validated' transaction is created and inventory is updated. | The replay attack test asserts no new records are created and no inventory is updated on the second attempt.","US-015","TASK-IAP-051-01,TASK-IAP-030-04","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,MongoDB"
"TASK-IAP-051-03: Write integration test for fulfillment failure","Create an integration test where the external platform validation is mocked to succeed, but the `PlayerInventoryRepository` is mocked to throw an error during the `grantItemsToPlayer` call. Assert that the final status of the transaction in the `IAPTransaction` collection is 'failed'.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",11.3,"test,integration-test,error-handling","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","__tests__/integration/iap.integration.test.ts (partial)","Platform gateway is mocked to return success. | `PlayerInventoryRepository.grantItemsToPlayer` is mocked to throw an error. | The test asserts that a transaction is created in the DB. | The test asserts the final `validationStatus` of that transaction is 'failed'.","US-015","TASK-IAP-051-01,TASK-IAP-030-04","2024-05-20 10:00","2024-05-20 10:00","Jest,TypeScript,MongoDB,Mocking"
"TASK-IAP-051-04: Write API-level (E2E) test using Supertest","Use a library like `supertest` to test the full HTTP endpoint. This test will start the Express app, send an HTTP `POST` request to `/api/iap/validate`, and assert the HTTP response. This verifies the routing, validation middleware, controller, and service work together.","Testing","Backlog","Critical","backend_dev@glyphweaver.com","pm@glyphweaver.com","",6.3,"test,e2e-test,api","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","__tests__/e2e/iap.e2e.test.ts","The test sends a real HTTP request to the in-memory app. | A test with a valid body and mocked upstream services returns a 200 OK. | A test with an invalid body (e.g., missing platform) returns a 400 Bad Request. | A test without an auth token returns a 401 Unauthorized (requires mocking the auth middleware).","US-015","TASK-IAP-043-02","2024-05-20 10:00","2024-05-20 10:00","Jest,Supertest,Express.js"
"US-016: Containerize the Application for Deployment","As an Operations Engineer, I need the application to be packaged in a lightweight, secure Docker container, so that I can deploy, scale, and manage it consistently across different environments.","User Story","Backlog","Critical","devops@glyphweaver.com","pm@glyphweaver.com","",10,"docker,deployment,ops","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","","GIVEN the project's `Dockerfile`, WHEN I run the `docker build` command, THEN it successfully creates a Docker image without errors. | GIVEN the built Docker image, WHEN I run it with the required environment variables, THEN the container starts and the Express server listens for requests on the exposed port. | GIVEN I inspect the final production-stage Docker image, WHEN I check its contents, THEN it contains only the necessary runtime artifacts (e.g., `dist`, `node_modules`) and does not contain source code or development tools.","","TASK-IAP-001-01,TASK-IAP-002-01","2024-05-20 10:00","2024-05-20 10:00","Docker"
"TASK-IAP-052-01: Create multi-stage Dockerfile and .dockerignore","Create a `Dockerfile` that uses a multi-stage build. The `build` stage installs all dependencies and runs `npm run build`. The final production stage copies `node_modules` (only production deps), the `dist` folder, and `package.json` into a minimal Node.js base image (e.g., node:18-alpine). Create a `.dockerignore` file to exclude `node_modules`, `.git`, `.env`, etc.","Deployment","Backlog","Critical","devops@glyphweaver.com","pm@glyphweaver.com","",10,"docker,deployment,ops","Sprint 3","EPIC-IAP-06: Quality Assurance and Operations","REPO-GLYPH-IAP","Dockerfile,.dockerignore","`Dockerfile` uses at least two stages. | The final image is based on a lean image like Alpine. | The final image does not contain `devDependencies` or source code. | `.dockerignore` file is present and correctly configured.","US-016","TASK-IAP-001-01,TASK-IAP-002-01","2024-05-20 10:00","2024-05-20 10:00","Docker"