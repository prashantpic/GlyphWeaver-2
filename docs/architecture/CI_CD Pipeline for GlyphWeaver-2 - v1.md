{"pipelines":[{"id":"pipeline-client-cicd","name":"Mobile Client CI/CD","description":"Builds, tests, packages, and distributes mobile client applications (iOS & Android).","stages":[{"name":"Build & Unit Test","steps":["Checkout code","Install dependencies (e.g., Unity Package Manager)","Run Unity headless build (iOS)","Run Unity headless build (Android)","Compile C# code","Run C# Unit Tests (Unity Test Framework)"],"environment":{"UNITY_BUILD_TARGET_IOS":"iOS","UNITY_BUILD_TARGET_ANDROID":"Android"},"qualityGates":[{"name":"Unit Tests Pass","criteria":["all unit tests status = passed"],"blocking":true},{"name":"Build Success","criteria":["iOS build artifact created","Android build artifact created"],"blocking":true}]},{"name":"Code Quality & Security Scan","steps":["Run C# static analysis (e.g., Roslyn Analyzers)","Run dependency vulnerability scan (if applicable to client libraries)"],"environment":{},"qualityGates":[{"name":"Static Analysis Clean","criteria":["no high/critical static analysis findings"],"blocking":false},{"name":"Dependency Scan Clean","criteria":["no critical dependency vulnerabilities"],"blocking":false}]},{"name":"Integration Testing (Simulated)","steps":["Deploy client build to iOS simulator/Android emulator","Run automated integration tests (e.g., testing core gameplay loop, persistence)","Run automated UI tests (if any, focus on layout, basic interactions, accessibility checks like text scaling)"],"environment":{"TEST_PLATFORM":"simulated"},"qualityGates":[{"name":"Integration Tests Pass","criteria":["all integration test status = passed"],"blocking":true}]},{"name":"Package & Artifacts","steps":["Package iOS build into IPA","Package Android build into APK","Sign IPA (using secure signing credentials)","Sign APK (using secure signing credentials)","Upload signed IPA to Artifact Repository (e.g., S3 bucket)","Upload signed APK to Artifact Repository (e.g., S3 bucket)"],"environment":{"ARTIFACT_REPO_URL":"${configuration.artifactRepository}","SIGNING_IDENTITY_IOS":"${secrets.ios_signing_identity}","SIGNING_KEYSTORE_ANDROID":"${secrets.android_keystore}"},"qualityGates":[{"name":"Artifacts Uploaded","criteria":["IPA artifact exists in repo","APK artifact exists in repo"],"blocking":true}]},{"name":"Deploy to Internal Testers","steps":["Download IPA/APK from Artifact Repository","Distribute IPA to TestFlight (using Fastlane or App Store Connect API)","Distribute APK to Firebase App Distribution (using Firebase CLI)"],"environment":{"TESTFLIGHT_APP_ID":"${secrets.testflight_app_id}","FIREBASE_APP_ID":"${secrets.firebase_app_id}"},"qualityGates":[{"name":"Distribution Successful","criteria":["iOS build visible in TestFlight","Android build visible in Firebase App Distribution"],"blocking":true}]},{"name":"Manual Approval for Store Submission","steps":["Wait for manual approval to proceed to store submission"],"environment":{},"qualityGates":[{"name":"Store Submission Approved","criteria":["manual approval received"],"blocking":true}]},{"name":"Submit to Production Stores","steps":["Download approved IPA/APK from Artifact Repository","Submit IPA to Apple App Store (using Fastlane or App Store Connect API)","Submit APK to Google Play Store (using Google Play Developer API)"],"environment":{"APP_STORE_CONNECT_KEY":"${secrets.app_store_connect_key}","GOOGLE_PLAY_KEY":"${secrets.google_play_key}"},"qualityGates":[{"name":"Submission Successful","criteria":["iOS build submitted to App Store","Android build submitted to Google Play Store"],"blocking":true}]}]},{"id":"pipeline-backend-cicd","name":"Backend Service CI/CD","description":"Builds, tests, containerizes, and deploys the backend API service.","stages":[{"name":"Build & Unit Test","steps":["Checkout code","Install Node.js dependencies (npm ci)","Compile TypeScript (tsc)","Run Backend Unit Tests (Jest/Mocha)"],"environment":{"NODE_ENV":"test"},"qualityGates":[{"name":"Unit Tests Pass","criteria":["all unit tests status = passed"],"blocking":true},{"name":"Compilation Success","criteria":["TypeScript compilation status = successful"],"blocking":true}]},{"name":"Code Quality & Security Scan","steps":["Run static analysis (ESLint/TSLint)","Run dependency vulnerability scan (npm audit)","Scan code for hardcoded secrets"],"environment":{},"qualityGates":[{"name":"Static Analysis Clean","criteria":["no high/critical static analysis findings"],"blocking":false},{"name":"Dependency Scan Clean","criteria":["no critical dependency vulnerabilities"],"blocking":true},{"name":"Secrets Scan Clean","criteria":["no secrets found in code"],"blocking":true}]},{"name":"Containerize & Scan","steps":["Build Docker image for backend service","Tag Docker image with commit hash/version","Scan Docker image for vulnerabilities (e.g., Trivy, Clair)"],"environment":{"DOCKER_BUILDKIT":"1"},"qualityGates":[{"name":"Docker Build Success","criteria":["Docker image artifact created"],"blocking":true},{"name":"Image Scan Clean","criteria":["no critical vulnerabilities found in image scan"],"blocking":true}]},{"name":"Push Artifacts","steps":["Push Docker image to Container Registry (e.g., ECR/GCR)","Generate API documentation (Swagger/OpenAPI - REQ-8-003)","Upload API documentation artifact to Artifact Repository"],"environment":{"CONTAINER_REGISTRY_URL":"${configuration.containerRegistry}","ARTIFACT_REPO_URL":"${configuration.artifactRepository}"},"qualityGates":[{"name":"Artifacts Pushed","criteria":["Docker image exists in registry","API docs artifact exists in repo"],"blocking":true}]},{"name":"Deploy to Staging","steps":["Update staging deployment manifest/definition with new image tag","Apply deployment to staging environment (e.g., using kubectl apply, or cloud provider deployment tool)","Wait for staging deployment rollout to complete successfully (based on container health checks)"],"environment":{"TARGET_ENV":"staging","KUBE_CONFIG":"${secrets.staging_kube_config}"}},{"name":"Integration & API Testing (Staging)","steps":["Run automated API tests against staging endpoint (covering REQ-SCF-003, REQ-8-013, REQ-SEC-008, REQ-8-014, REQ-SEC-005)","Run automated integration tests (e.g., testing service-to-database interaction)"],"environment":{"API_ENDPOINT":"${environment.staging.api_url}","MONGO_DB_URL":"${environment.staging.mongodb_url}"},"qualityGates":[{"name":"Staging Tests Pass","criteria":["all API tests status = passed","all integration test status = passed"],"blocking":true}]},{"name":"Smoke Test (Staging)","steps":["Run basic health check endpoints on staging (REQ-AMOT-005)"],"environment":{"HEALTH_CHECK_ENDPOINT":"${environment.staging.health_check_url}"},"qualityGates":[{"name":"Staging Smoke Test Pass","criteria":["health check status = 200 OK"],"blocking":true}]},{"name":"Manual Approval for Production","steps":["Wait for manual approval to deploy to production"],"environment":{},"qualityGates":[{"name":"Production Deployment Approved","criteria":["manual approval received"],"blocking":true}]},{"name":"Deploy to Production","steps":["Update production deployment manifest/definition with new image tag","Apply rolling update deployment to production environment (REQ-8-008)","Wait for production deployment rollout to complete successfully (based on container health checks - REQ-AMOT-005)"],"environment":{"TARGET_ENV":"production","KUBE_CONFIG":"${secrets.production_kube_config}","MONGO_DB_URL":"${secrets.production_mongodb_url}","REDIS_URL":"${secrets.production_redis_url}","PLATFORM_IAP_KEYS":"${secrets.platform_iap_validation_keys}"}},{"name":"Post-Deployment Validation (Production)","steps":["Run production smoke tests / health checks (REQ-AMOT-005)"],"environment":{"HEALTH_CHECK_ENDPOINT":"${environment.production.health_check_url}"},"qualityGates":[{"name":"Production Smoke Test Pass","criteria":["health check status = 200 OK"],"blocking":true}]}]},{"id":"pipeline-config-deploy","name":"Configuration Deployment","description":"Deploys dynamic game configurations to the backend service (REQ-8-023).","stages":[{"name":"Validate Configuration","steps":["Checkout configuration files","Validate configuration schema and syntax (e.g., JSON schema validation)"],"environment":{},"qualityGates":[{"name":"Configuration Valid","criteria":["configuration syntax is valid","configuration schema is valid"],"blocking":true}]},{"name":"Manual Approval for Production Config","steps":["Wait for manual approval for deploying configuration to production"],"environment":{},"qualityGates":[{"name":"Production Config Approved","criteria":["manual approval received"],"blocking":true}]},{"name":"Deploy Configuration","steps":["Push validated configuration to Backend Configuration Service (e.g., via API or config management tool)"],"environment":{"CONFIG_SERVICE_ENDPOINT":"${environment.production.config_service_api_url}","AUTH_TOKEN":"${secrets.config_deployment_token}"},"qualityGates":[{"name":"Configuration Deployed","criteria":["configuration service confirms update successful"],"blocking":true}]}]}],"configuration":{"artifactRepository":"s3://glyphpuzzle-artifacts","containerRegistry":"123456789012.dkr.ecr.us-east-1.amazonaws.com/glyphpuzzle-backend","defaultBranch":"main","retentionPolicy":"90d","notificationChannel":"slack#deployments","secretsManagementSystem":"AWS Secrets Manager / GCP Secret Manager / Azure Key Vault"}}